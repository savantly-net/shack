<#import "/spring.ftl" as spring />
<div id="schackContainer">
	<h1>PM2 Process</h1>
	
	<nav>
		<button class="mat-raised-button" onclick="shack.loadProcessInfo();">Load</button>
	</nav>
	
	<div class="shack-processes"></div>

</div>


<script type="text/javascript">
	function Shack() {
		
		// extend the sprout api
		sprout.__proto__.showLoader = function (key, options) {
			sprout.zone.run(function(){
				if (!key) {
					throw new Error('A key is required to show the loader, so that it may be removed with the same key.');
				}
				var defaultElement = document.querySelector('my-client-api');
				options = options || {};
				options.element = options.element || defaultElement;
				
				var imgWrapper = document.createElement('div');
				imgWrapper.setAttribute('id', key);
				imgWrapper.setAttribute('style', 'text-align:center;');
				
				var imgElement = document.createElement('img');
				imgElement.setAttribute('style', 'width:200px;');
				imgElement.setAttribute('src', './img/loader.svg');
				
				imgWrapper.appendChild(imgElement);
				options.element.appendChild(imgWrapper);
			});
		};
		
		sprout.__proto__.hideLoader = function (key) {
			sprout.zone.run(function(){
				if (!key) {
					throw new Error('A key is required to remove the loader');
				}
				var imgWrapper = document.querySelector('div#'+key);
				imgWrapper.remove();
			});
		};
		
		var processInfoElement = document.querySelector('.shack-processes');
		

		this.loadProcessInfo = function(){
			var loaderKey = 'pLoader';
			sprout.showLoader(loaderKey);
			sprout.zone.run(function(){
				sprout.http.get('./rest/modules/shack/processes', {responseType: 'text'}).subscribe(function(response){
					processInfoElement.innerHTML = response;
					sprout.hideLoader(loaderKey);
				});
			});
		};
		
		
	}
	window.shack = new Shack();
</script>